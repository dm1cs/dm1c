<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
	<meta name="format-detection" content="telephone=no">
	<!-- <style>body{opacity: 0;}</style> -->
	<link rel="stylesheet" href="../css/style.min.css?_v=20220112232913">
	<link rel="stylesheet" href="../css/code.css">
	<!-- <meta name="robots" content="noindex, nofollow"> -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Загрузка из Excel - DM1C</title>
</head>
<body>
    <div class="wrapper">
		<header class="header">
			<div class="header__container header__container_new">
				<div class="header__menu menu">
					<nav class="menu__body">
						<ul class="menu__list">
							<li class="menu__item"><a href="/dm1c" class="menu__link">Главная</a></li>
							<li class="menu__item"><a href="/dm1c#examples" class="menu__link">Примеры</a></li>
						</ul>
					</nav>
				</div>
			</div>
		</header>
		<main class="page">
			<section class="page__about about">
				<div class="about__container">
					<div class="about__info">
						<h1 class="about__title title">Загрузка из <br> Microsoft Excel</h1>
					</div>
				</div>
			</section>

			<section class="page__top-works top-works">
				<div class="top-works__container">
					<div class="top-works__body">
						<div class="top-works__title header-title">Пример</div>
						<pre>
							<code class="language-onec8 hljs" highlight-set="1">
ЭлементБлокировки = БлокировкаДанных.Добавить("РегистрНакопления.ОстаткиНоменклатуры");
ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;

ЗапросИсточник = Новый Запрос:
ЗапросИсточник.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
| СборкаСписокНоменклатуры.Комплектующее КАК Номенклатура
тиз
| Документ.Сборка.Комплектующие КАК СборкаСписокНоменклатуры
|ГДЕ
| СборкаСписокНоменклатуры.Ссылка = &Ссылка";
ЗапросИсточник.УстановитьПараметр ("Ссылка", Ссылка);
ИсточникНоменклатуры = ЗапросИсточник.Выполнить();

ЭлементБлокировки.ИсточникДанных = ИсточникНоменклатуры;
ЭлементБлокировки.ИспользоватьИзИсточникаДанных("Номенклатура", "Номенклатура") ;
БлокировкаДанных.Заблокировать();
// регистр ОстаткиНоменклатуры Расход
Движения.ОстаткиНоменклатуры.Записывать = Истина:
Для Каждого ТекСтрокаКомплектующие Из Комплектующие Цикл
Движение = Движения.ОстаткиНоменклатуры.Добавить();
Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
Движение.Период = Дата;
Движение.Номенклатура = ТекСтрокаКомплектующие.Комплектующее;
Движение.Количество = ТекСтрокаКомплектующие.Количество;
Конеццикла;
Движения.Записать();
Запрос=новый Запрос;
запрос.Текст= "ВЫВРАТЬ
| ОстаткиНноменклатурыОстатки.Номенклатура КАК Номенклатура,
| ОстаткиНноменклатурыОстатки.КоличествоОстаток КАК КоличествоОстаток
|из
| РегистрНакопления.ОстаткиНоменклатуры.Остатки КАК ОстаткиНоменклатурыОстатки
|ГДЕ
| ОстаткиНоменклатурыОстатки.КоличествоОстаток < 0
| И ОстаткиНоменклатурыОстатки.Номенклатура В (Списокноменклатуры) ";
Запрос.УстановитьПараметр("СписокНоменклатуры”, Комплектующие.ВыгрузитьКолонку ("Комплектующее"));
выборка=Запрос.Выполнить ().Выбрать();
СообщениеПользователю-"";
Пока Выборка.Следующий () Цикл
Отказ=Истина;
СообщениеПользователю=СообщениеПользователю + "Не хватает "+Выборка.Номенклатура+" в количестве "+Строка(-Выборка.КоличествоОстаток) + СимволыПС;
КонецЦикла;
Сообщить (Лев(СообщениеПользователю, СтрДлина(СообщениеПользователю) -1));
КонецПроцедуры

							</code>
						</pre>
					</div>
				</div>
			</section>

		</main>
		<footer class="footer">
			<div class="footer__container">
				<div class="footer__copyright">Copyright ©2023 All rights reserved</div>
			</div>
		</footer>
	</div>
	<script src="/js/app.min.js?_v=20220112232913"></script>
</body>
</html>
